<html>
    <head>
        <style>
            button {
                border: none;
                color: black;
                padding: 15px 32px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 16px;
                margin: 4px 2px;
                cursor: pointer;
            }

            .text-center {
                text-align: center;
            
            
            }
        </style>

        <script>
            class Card {
                id;
                constructor(value, suit) {
                    this.value = value;
                    this.suit = suit;
                    this.id = `${value}${suit}`;
                    // store location?
                }
            }

            const deckArray = [new Card(5, 1), new Card(5, 2), new Card(9, 1), new Card(9, 2), new Card(2, 2)];
            const topHandArray = [];
            const bottomHandArray = [];
            const topBoardArray = [];
            const bottomBoardArray = [];
            const discardArray = [];

            function draw(id) {
                drawButtonId = document.getElementById(id).id;
                
                if (drawButtonId === "topDraw") {
                    let topHandElement = document.getElementById("topHand");
                    let topHandSize = topHandElement.children.length;
                
                    if (topHandSize < 6 && deckArray.length > 0) {
                        let cardMovingToTopHand = deckArray.pop();
                        topHandArray.push(cardMovingToTopHand);

                        let newTopHandCard = document.createElement("BUTTON");
                        newTopHandCard.type="button";
                        newTopHandCard.textContent = cardMovingToTopHand.value + " - " + cardMovingToTopHand.suit;
                        newTopHandCard.id=cardMovingToTopHand.id;
                        newTopHandCard.setAttribute("value", cardMovingToTopHand.value);
                        newTopHandCard.setAttribute("suit", cardMovingToTopHand.suit);
                        newTopHandCard.setAttribute("onClick","play(this.id);");
                        newTopHandCard.classList.add("top", "hand");

                        topHandElement.appendChild(newTopHandCard);
                    }
                } else if (drawButtonId === "bottomDraw") {
                    let bottomHandElement = document.getElementById("bottomHand");
                    let bottomHandSize = bottomHandElement.children.length;
                
                    if (bottomHandSize < 6 && deckArray.length > 0) {
                        let cardMovingToBottomHand = deckArray.pop();
                        bottomHandArray.push(cardMovingToBottomHand);

                        let newBottomHandCard = document.createElement("BUTTON");
                        newBottomHandCard.type = "button";
                        newBottomHandCard.textContent = cardMovingToBottomHand.value + " - " + cardMovingToBottomHand.suit;
                        newBottomHandCard.id=cardMovingToBottomHand.id;
                        newBottomHandCard.setAttribute("value", cardMovingToBottomHand.value);
                        newBottomHandCard.setAttribute("suit", cardMovingToBottomHand.suit);
                        newBottomHandCard.setAttribute("onClick","play(this.id);");
                        newBottomHandCard.classList.add("bottom", "hand");
                        
                        bottomHandElement.appendChild(newBottomHandCard);
                    }
                } else {
                    throw "Invalid draw id";
                }
                return 0;
            }

            function play(id) {
                let clickedCardElement = document.getElementById(id);
                
                let priorityElement = document.getElementById("priority");
                let attackerElement = document.getElementById("attacker");

                let whosPriority = priorityElement.getAttribute("value");
                let whosAttacker = attackerElement.getAttribute("value");

                let clickedCardValue = clickedCardElement.getAttribute("value");

                // check priority
                if (!clickedCardElement.classList.contains(whosPriority)) {
                    return 0;
                }

                if ( // check if card can be played
                    ( // attacker can play any card if none on field
                        clickedCardElement.classList.contains(whosAttacker) && // attacker
                        (topBoardArray.length === 0 && bottomBoardArray.length === 0) // nothing on field
                    )
                
                ||

                    (// bottom defender can play card of a higher value and same suit
                        whosPriority === "bottom" &&
                        !clickedCardElement.classList.contains(whosAttacker) && 
                        clickedCardValue > topBoardArray[topBoardArray.length - 1].value &&
                        clickedCardElement.getAttribute("suit") === topBoardArray[topBoardArray.length - 1].suit
                    )

                ||

                    ( // top defender can play card of a higher value and same suit
                        whosPriority === "top" &&
                        !clickedCardElement.classList.contains(whosAttacker) &&
                        clickedCardValue > bottomBoardArray[bottomBoardArray.length - 1].value &&
                        clickedCardElement.getAttribute("suit") === bottomBoardArray[bottomBoardArray.length - 1].suit
                    )

                ||

                    ( // bottom attacker can play card with same value
                        clickedCardElement.classList.contains(whosAttacker) && // attacker
                        bottomBoardArray.find(o => {
                            return o.value === clickedCardValue;
                        })
                    )

                ||

                    ( // top attacker can play card with same value
                        clickedCardElement.classList.contains(whosAttacker) && // attacker
                        topBoardArray.find(o => {
                            return o.value === clickedCardValue;
                        })
                    )
                ) {
                    let fieldElement = document.getElementById(whosPriority + "Board");

                    let cardMovingToField = document.createElement("BUTTON");
                    cardMovingToField.type = "button";
                    cardMovingToField.textContent = clickedCardElement.value + " - " + clickedCardElement.getAttribute("suit");
                    cardMovingToField.id = clickedCardElement.id;
                    cardMovingToField.setAttribute("value", clickedCardElement.value);
                    cardMovingToField.setAttribute("suit", clickedCardElement.getAttribute("suit"));

                    cardMovingToField.classList.remove("hand");
                    cardMovingToField.classList.add("field");

                    fieldElement.appendChild(cardMovingToField);


                    if (clickedCardElement.classList.contains("top")) {
                        topBoardArray.push(new Card(clickedCardElement.value, clickedCardElement.getAttribute("suit")));
                        topHandArray.splice(topHandArray.findIndex(o => o.id === clickedCardElement.id), 1);

                        priorityElement.setAttribute("value", "bottom");
                        priorityElement.innerText = "Priority: Bottom";
                        
                    } else if (clickedCardElement.classList.contains("bottom")) {
                        bottomBoardArray.push(new Card(clickedCardElement.value, clickedCardElement.getAttribute("suit")));
                        bottomHandArray.splice(bottomHandArray.findIndex(o => o.id === clickedCardElement.id), 1);

                        priorityElement.setAttribute("value", "top");
                        priorityElement.innerText = "Priority: Top";
                    }

                    clickedCardElement.remove();
                }
            }

            function take(id) {
                var takeButton = document.getElementById(id);
                var attacker = document.getElementById("attacker").getAttribute("value");
                var priority = document.getElementById("priority").getAttribute("value");
                if (!takeButton.classList.contains(attacker) && takeButton.classList.contains(priority)) {
                    // pop cards from field and put them in defenders hand, change priority
                    if (takeButton.classList.contains("bottom")) {
                        for (var i = 0; i < topBoard.length; i++) {
                            var movingCard = topBoard.pop();
                            var card = document.getElementById(movingCard);
                            card.remove();

                            bottomHand.push(movingCard);

                            var newCard = document.createElement("BUTTON");
                            newCard.type="button";
                            newCard.textContent=movingCard;
                            newCard.id=movingCard;
                            newCard.classList.add("bottom", "hand");
                            newCard.setAttribute("onClick","play(this.id);");

                            bottomHandElement = document.getElementById("bottomHand");
                            bottomHandElement.appendChild(newCard);
                        }
                        for (var i = 0; i < bottomBoard.length; i++) {
                            var movingCard = bottomBoard.pop();
                            var card = document.getElementById(movingCard);
                            card.remove();

                            bottomHand.push(movingCard);

                            var newCard = document.createElement("BUTTON");
                            newCard.type="button";
                            newCard.textContent=movingCard;
                            newCard.id=movingCard;
                            newCard.classList.add("bottom", "hand");
                            newCard.setAttribute("onClick","play(this.id);");

                            bottomHandElement = document.getElementById("bottomHand");
                            bottomHandElement.appendChild(newCard);
                        }
                        document.getElementById("priority").setAttribute("value", "top");
                        document.getElementById("priority").innerText ="Priority: Top";

                    } else if (takeButton.classList.contains("top")) {
                        for (var i = 0; i < topBoard.length; i++) {
                            var movingCard = topBoard.pop();
                            var card = document.getElementById(movingCard);
                            card.remove();

                            topHand.push(movingCard);

                            var newCard = document.createElement("BUTTON");
                            newCard.type="button";
                            newCard.textContent=movingCard;
                            newCard.id=movingCard;
                            newCard.classList.add("top", "hand");
                            newCard.setAttribute("onClick","play(this.id);");

                            topHandElement = document.getElementById("topHand");
                            topHandElement.appendChild(newCard);
                        }
                        for (var i = 0; i < bottomBoard.length; i++) {
                            var movingCard = bottomBoard.pop();
                            var card = document.getElementById(movingCard);
                            card.remove();

                            topHand.push(movingCard);

                            var newCard = document.createElement("BUTTON");
                            newCard.type="button";
                            newCard.textContent=movingCard;
                            newCard.id=movingCard;
                            newCard.classList.add("top", "hand");
                            newCard.setAttribute("onClick","play(this.id);");

                            topHandElement = document.getElementById("topHand");
                            topHandElement.appendChild(newCard);
                        }
                        document.getElementById("priority").setAttribute("value", "bottom");
                        document.getElementById("priority").innerText ="Priority: Bottom";
                    }
                } else {
                    return 0;
                }
            }

            function pass(id) {
                //can only pass if attacker and field arrays have same length
                // switch turn and priority
                //remove field cards
                var passButton = document.getElementById(id);
                var priority = document.getElementById("priority").getAttribute("value");
                var attacker = document.getElementById("attacker").getAttribute("value");
                

                if (
                    passButton.classList.contains(priority) && 
                    passButton.classList.contains(attacker) &&
                    topBoard.length !== 0 &&
                    topBoard.length === bottomBoard.length
                    ) 
                    {
                        for (var i = 0; i < topBoard.length; i++) {
                            var movingCard = document.getElementById(topBoard.pop());
                            discard.push(movingCard.id);
                            movingCard.remove();
                        }
                        for (var i = 0; i < bottomBoard.length; i++) {
                            var movingCard = document.getElementById(bottomBoard.pop());
                            discard.push(movingCard.id);
                            movingCard.remove();
                        }
                        if (passButton.classList.contains("top")) {
                            document.getElementById("priority").setAttribute("value", "bottom");
                            document.getElementById("priority").innerText="Priority: Bottom";
                            document.getElementById("attacker").setAttribute("value", "bottom");
                            document.getElementById("attacker").innerText="Attacker: Bottom";
                        } else if (passButton.classList.contains("bottom")) {
                            document.getElementById("priority").setAttribute("value", "top");
                            document.getElementById("priority").innerText="Priority: Top";
                            document.getElementById("attacker").setAttribute("value", "top");
                            document.getElementById("attacker").innerText="Attacker: Top";
                        }
                }

            }
    </script>
    </head>

    <body>
        <h2 id="attacker" value="bottom">Attacker: Bottom</h2>
        <h2 id="priority" value="bottom">Priority: Bottom</h2>
        <div class="text-center">
            <br>

            <div id="topOptions">
                <button id="topDraw" class="top draw" type="button" onclick="draw(this.id)">Draw</button>
                <button id="topTake" class="top take" type="button" onclick="take(this.id)">Take</button>
                <button id="topPass" class="top pass" type="button" onclick="pass(this.id)">Pass</button>
            </div>
            <div id="topHand">

            </div>
            <br>

            <div id="topBoard">
            
            </div>

            <br>
    
            <div id="bottomBoard">
            
            </div>

            <br>

            <div id="bottomHand">
                
            </div>

            <div id="bottomOptions">
                <button id="bottomDraw" class="bottom draw" type="button" onclick="draw(this.id)">Draw</button>
                <button id="bottomTake" class="bottom take" type="button" onclick="take(this.id)">Take</button>
                <button id="bottomPass" class="bottom pass" type="button" onclick="pass(this.id)">Pass</button>
            </div>
        </div>
        
    </body>
</html>